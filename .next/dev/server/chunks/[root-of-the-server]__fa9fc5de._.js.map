{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/storage.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_DIR = path.join(process.cwd(), '.data');\r\nconst COURSES_FILE = path.join(DATA_DIR, 'courses.json');\r\nconst QUIZZES_FILE = path.join(DATA_DIR, 'quizzes.json');\r\nconst ASSIGNMENTS_FILE = path.join(DATA_DIR, 'assignments.json');\r\nconst ATTEMPTS_FILE = path.join(DATA_DIR, 'attempts.json');\r\n\r\n// Ensure data directory exists\r\nfunction ensureDataDir() {\r\n  if (!fs.existsSync(DATA_DIR)) {\r\n    fs.mkdirSync(DATA_DIR, { recursive: true });\r\n  }\r\n}\r\n\r\n// Load data from file or return empty array\r\nfunction loadFromFile(filePath: string): any[] {\r\n  try {\r\n    ensureDataDir();\r\n    if (fs.existsSync(filePath)) {\r\n      const data = fs.readFileSync(filePath, 'utf-8');\r\n      return JSON.parse(data);\r\n    }\r\n  } catch (error) {\r\n    console.error(`Error loading ${filePath}:`, error);\r\n  }\r\n  return [];\r\n}\r\n\r\n// Save data to file\r\nfunction saveToFile(filePath: string, data: any) {\r\n  try {\r\n    ensureDataDir();\r\n    fs.writeFileSync(filePath, JSON.stringify(data, null, 2), 'utf-8');\r\n  } catch (error) {\r\n    console.error(`Error saving to ${filePath}:`, error);\r\n  }\r\n}\r\n\r\n// Courses\r\nexport const coursesStore: Map<string, any> = new Map();\r\nfunction loadCourses() {\r\n  const data = loadFromFile(COURSES_FILE);\r\n  data.forEach((course: any) => coursesStore.set(course.id, course));\r\n}\r\nexport function saveCourses() {\r\n  const data = Array.from(coursesStore.values());\r\n  saveToFile(COURSES_FILE, data);\r\n}\r\n\r\n// Quizzes\r\nexport const quizzesStore: Map<string, any> = new Map();\r\nfunction loadQuizzes() {\r\n  const data = loadFromFile(QUIZZES_FILE);\r\n  data.forEach((quiz: any) => quizzesStore.set(quiz.id, quiz));\r\n}\r\nexport function saveQuizzes() {\r\n  const data = Array.from(quizzesStore.values());\r\n  saveToFile(QUIZZES_FILE, data);\r\n}\r\n\r\n// Assignments\r\nexport const assignmentsStore: Map<string, any> = new Map();\r\nfunction loadAssignments() {\r\n  const data = loadFromFile(ASSIGNMENTS_FILE);\r\n  data.forEach((assignment: any) => assignmentsStore.set(assignment.id, assignment));\r\n}\r\nexport function saveAssignments() {\r\n  const data = Array.from(assignmentsStore.values());\r\n  saveToFile(ASSIGNMENTS_FILE, data);\r\n}\r\n\r\n// Quiz Attempts\r\nexport const quizAttemptsStore: Map<string, any> = new Map();\r\nfunction loadAttempts() {\r\n  const data = loadFromFile(ATTEMPTS_FILE);\r\n  data.forEach((attempt: any) => quizAttemptsStore.set(attempt.id, attempt));\r\n}\r\nexport function saveAttempts() {\r\n  const data = Array.from(quizAttemptsStore.values());\r\n  saveToFile(ATTEMPTS_FILE, data);\r\n}\r\n\r\n// ID counters\r\nexport let courseIdCounter = 1;\r\nexport let quizIdCounter = 1;\r\nexport let assignmentIdCounter = 1;\r\nexport let quizAttemptIdCounter = 1;\r\n\r\n// Track if storage has been initialized\r\nlet isInitialized = false;\r\n\r\n// Initialize all data on startup\r\nexport function initializeStorage() {\r\n  if (isInitialized) return; // Skip if already initialized\r\n  isInitialized = true;\r\n  \r\n  loadCourses();\r\n  loadQuizzes();\r\n  loadAssignments();\r\n  loadAttempts();\r\n  \r\n  // Set counters based on existing data\r\n  if (coursesStore.size > 0) {\r\n    courseIdCounter = Math.max(...Array.from(coursesStore.values()).map((c: any) => {\r\n      const match = c.id.match(/course_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizzesStore.size > 0) {\r\n    quizIdCounter = Math.max(...Array.from(quizzesStore.values()).map((q: any) => {\r\n      const match = q.id.match(/quiz_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (assignmentsStore.size > 0) {\r\n    assignmentIdCounter = Math.max(...Array.from(assignmentsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/assignment_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizAttemptsStore.size > 0) {\r\n    quizAttemptIdCounter = Math.max(...Array.from(quizAttemptsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/attempt_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  console.log('Storage initialized');\r\n}\r\n\r\nexport function incrementCourseId() {\r\n  const id = courseIdCounter++;\r\n  saveCourses();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizId() {\r\n  const id = quizIdCounter++;\r\n  saveQuizzes();\r\n  return id;\r\n}\r\n\r\nexport function incrementAssignmentId() {\r\n  const id = assignmentIdCounter++;\r\n  saveAssignments();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizAttemptId() {\r\n  const id = quizAttemptIdCounter++;\r\n  saveAttempts();\r\n  return id;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/auth.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'your-secret-key-change-in-production');\n\nexport async function createToken(userId: string, email: string, role: string) {\n  const token = await new SignJWT({ userId, email, role })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(JWT_SECRET);\n  \n  return token;\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const verified = await jwtVerify(token, JWT_SECRET);\n    return verified.payload as { userId: string; email: string; role: string };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set('auth-token', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 7 * 24 * 60 * 60,\n  });\n}\n\nexport async function getAuthToken() {\n  const cookieStore = await cookies();\n  return cookieStore.get('auth-token')?.value;\n}\n\nexport async function getCurrentUser() {\n  const token = await getAuthToken();\n  if (!token) return null;\n  return verifyToken(token);\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete('auth-token');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE/D,eAAe,YAAY,MAAc,EAAE,KAAa,EAAE,IAAY;IAC3E,MAAM,QAAQ,MAAM,IAAI,mLAAO,CAAC;QAAE;QAAQ;QAAO;IAAK,GACnD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,OAAO;AACT;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,uLAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;IACxB;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,OAAO,YAAY,GAAG,CAAC,eAAe;AACxC;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,YAAY;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 297, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/app/api/quizzes/submissions/%5Bid%5D/grade/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { initializeStorage, quizAttemptsStore, saveAttempts } from '@/lib/storage';\r\nimport { getCurrentUser } from '@/lib/auth';\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: { id: string } }\r\n) {\r\n  try {\r\n    // Verify user is authenticated and is a teacher\r\n    const user = await getCurrentUser();\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { score } = await request.json();\r\n\r\n    // Validate score\r\n    if (typeof score !== 'number' || score < 0 || score > 100) {\r\n      return NextResponse.json(\r\n        { error: 'Score must be a number between 0 and 100' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Initialize storage\r\n    await initializeStorage();\r\n\r\n    // Find and update the attempt\r\n    const attempt = quizAttemptsStore.get(params.id);\r\n    if (!attempt) {\r\n      return NextResponse.json(\r\n        { error: 'Submission not found' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Update the score\r\n    attempt.score = score;\r\n    attempt.graded_at = new Date().toISOString();\r\n    attempt.graded_by = user.email;\r\n    quizAttemptsStore.set(params.id, attempt);\r\n\r\n    // Save to file\r\n    await saveAttempts();\r\n\r\n    return NextResponse.json(attempt);\r\n  } catch (error) {\r\n    console.error('Error grading submission:', error);\r\n    return NextResponse.json(\r\n      { error: 'Failed to grade submission' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KACpB,OAAoB,EACpB,EAAE,MAAM,EAA8B;IAEtC,IAAI;QACF,gDAAgD;QAChD,MAAM,OAAO,MAAM,IAAA,gJAAc;QACjC,IAAI,CAAC,MAAM;YACT,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpC,iBAAiB;QACjB,IAAI,OAAO,UAAU,YAAY,QAAQ,KAAK,QAAQ,KAAK;YACzD,OAAO,iKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2C,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,IAAA,sJAAiB;QAEvB,8BAA8B;QAC9B,MAAM,UAAU,sJAAiB,CAAC,GAAG,CAAC,OAAO,EAAE;QAC/C,IAAI,CAAC,SAAS;YACZ,OAAO,iKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,QAAQ,KAAK,GAAG;QAChB,QAAQ,SAAS,GAAG,IAAI,OAAO,WAAW;QAC1C,QAAQ,SAAS,GAAG,KAAK,KAAK;QAC9B,sJAAiB,CAAC,GAAG,CAAC,OAAO,EAAE,EAAE;QAEjC,eAAe;QACf,MAAM,IAAA,iJAAY;QAElB,OAAO,iKAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,iKAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}