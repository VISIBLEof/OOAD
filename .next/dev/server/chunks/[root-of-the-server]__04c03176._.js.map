{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/storage.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_DIR = path.join(process.cwd(), '.data');\r\nconst COURSES_FILE = path.join(DATA_DIR, 'courses.json');\r\nconst QUIZZES_FILE = path.join(DATA_DIR, 'quizzes.json');\r\nconst ASSIGNMENTS_FILE = path.join(DATA_DIR, 'assignments.json');\r\nconst ATTEMPTS_FILE = path.join(DATA_DIR, 'attempts.json');\r\n\r\n// Ensure data directory exists\r\nfunction ensureDataDir() {\r\n  if (!fs.existsSync(DATA_DIR)) {\r\n    fs.mkdirSync(DATA_DIR, { recursive: true });\r\n  }\r\n}\r\n\r\n// Load data from file or return empty array\r\nfunction loadFromFile(filePath: string): any[] {\r\n  try {\r\n    ensureDataDir();\r\n    if (fs.existsSync(filePath)) {\r\n      const data = fs.readFileSync(filePath, 'utf-8');\r\n      return JSON.parse(data);\r\n    }\r\n  } catch (error) {\r\n    console.error(`Error loading ${filePath}:`, error);\r\n  }\r\n  return [];\r\n}\r\n\r\n// Save data to file\r\nfunction saveToFile(filePath: string, data: any) {\r\n  try {\r\n    ensureDataDir();\r\n    fs.writeFileSync(filePath, JSON.stringify(data, null, 2), 'utf-8');\r\n  } catch (error) {\r\n    console.error(`Error saving to ${filePath}:`, error);\r\n  }\r\n}\r\n\r\n// Courses\r\nexport const coursesStore: Map<string, any> = new Map();\r\nfunction loadCourses() {\r\n  const data = loadFromFile(COURSES_FILE);\r\n  data.forEach((course: any) => coursesStore.set(course.id, course));\r\n}\r\nexport function saveCourses() {\r\n  const data = Array.from(coursesStore.values());\r\n  saveToFile(COURSES_FILE, data);\r\n}\r\n\r\n// Quizzes\r\nexport const quizzesStore: Map<string, any> = new Map();\r\nfunction loadQuizzes() {\r\n  const data = loadFromFile(QUIZZES_FILE);\r\n  data.forEach((quiz: any) => quizzesStore.set(quiz.id, quiz));\r\n}\r\nexport function saveQuizzes() {\r\n  const data = Array.from(quizzesStore.values());\r\n  saveToFile(QUIZZES_FILE, data);\r\n}\r\n\r\n// Assignments\r\nexport const assignmentsStore: Map<string, any> = new Map();\r\nfunction loadAssignments() {\r\n  const data = loadFromFile(ASSIGNMENTS_FILE);\r\n  data.forEach((assignment: any) => assignmentsStore.set(assignment.id, assignment));\r\n}\r\nexport function saveAssignments() {\r\n  const data = Array.from(assignmentsStore.values());\r\n  saveToFile(ASSIGNMENTS_FILE, data);\r\n}\r\n\r\n// Quiz Attempts\r\nexport const quizAttemptsStore: Map<string, any> = new Map();\r\nfunction loadAttempts() {\r\n  const data = loadFromFile(ATTEMPTS_FILE);\r\n  data.forEach((attempt: any) => quizAttemptsStore.set(attempt.id, attempt));\r\n}\r\nexport function saveAttempts() {\r\n  const data = Array.from(quizAttemptsStore.values());\r\n  saveToFile(ATTEMPTS_FILE, data);\r\n}\r\n\r\n// ID counters\r\nexport let courseIdCounter = 1;\r\nexport let quizIdCounter = 1;\r\nexport let assignmentIdCounter = 1;\r\nexport let quizAttemptIdCounter = 1;\r\n\r\n// Track if storage has been initialized\r\nlet isInitialized = false;\r\n\r\n// Initialize all data on startup\r\nexport function initializeStorage() {\r\n  if (isInitialized) return; // Skip if already initialized\r\n  isInitialized = true;\r\n  \r\n  loadCourses();\r\n  loadQuizzes();\r\n  loadAssignments();\r\n  loadAttempts();\r\n  \r\n  // Set counters based on existing data\r\n  if (coursesStore.size > 0) {\r\n    courseIdCounter = Math.max(...Array.from(coursesStore.values()).map((c: any) => {\r\n      const match = c.id.match(/course_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizzesStore.size > 0) {\r\n    quizIdCounter = Math.max(...Array.from(quizzesStore.values()).map((q: any) => {\r\n      const match = q.id.match(/quiz_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (assignmentsStore.size > 0) {\r\n    assignmentIdCounter = Math.max(...Array.from(assignmentsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/assignment_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizAttemptsStore.size > 0) {\r\n    quizAttemptIdCounter = Math.max(...Array.from(quizAttemptsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/attempt_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  console.log('Storage initialized');\r\n}\r\n\r\nexport function incrementCourseId() {\r\n  const id = courseIdCounter++;\r\n  saveCourses();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizId() {\r\n  const id = quizIdCounter++;\r\n  saveQuizzes();\r\n  return id;\r\n}\r\n\r\nexport function incrementAssignmentId() {\r\n  const id = assignmentIdCounter++;\r\n  saveAssignments();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizAttemptId() {\r\n  const id = quizAttemptIdCounter++;\r\n  saveAttempts();\r\n  return id;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/app/api/quizzes/submissions/%5Bid%5D/grade/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { initializeStorage, quizAttemptsStore, saveAttempts } from '@/lib/storage';\r\n\r\nexport async function POST(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id } = await params;\r\n    const body = await request.json();\r\n    const { score } = body;\r\n\r\n    console.log(`[Grade] Submission ID: ${id}, Score: ${score}`);\r\n\r\n    // Validate score\r\n    if (typeof score !== 'number' || score < 0 || score > 100) {\r\n      console.log(`[Grade] Invalid score: ${score}`);\r\n      return NextResponse.json(\r\n        { error: 'Score must be a number between 0 and 100' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Initialize storage\r\n    console.log('[Grade] Initializing storage');\r\n    await initializeStorage();\r\n\r\n    // Find and update the attempt\r\n    const attempt = quizAttemptsStore.get(id);\r\n    console.log(`[Grade] Attempt found: ${attempt ? 'yes' : 'no'}`);\r\n    console.log(`[Grade] Store size: ${quizAttemptsStore.size}`);\r\n    console.log(`[Grade] All keys in store:`, Array.from(quizAttemptsStore.keys()));\r\n    \r\n    if (!attempt) {\r\n      console.log(`[Grade] Submission ${id} not found`);\r\n      return NextResponse.json(\r\n        { error: `Submission ${id} not found` },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Update the score\r\n    const oldScore = attempt.score;\r\n    attempt.score = score;\r\n    attempt.graded_at = new Date().toISOString();\r\n    attempt.graded_by = 'teacher';\r\n    quizAttemptsStore.set(id, attempt);\r\n\r\n    console.log(`[Grade] Updated attempt - old score: ${oldScore}, new score: ${score}`);\r\n\r\n    // Save to file\r\n    console.log('[Grade] Saving attempts to file');\r\n    await saveAttempts();\r\n\r\n    console.log('[Grade] Grade saved successfully');\r\n    return NextResponse.json(attempt);\r\n  } catch (error) {\r\n    console.error('[Grade] Error:', error);\r\n    return NextResponse.json(\r\n      { error: `Failed to grade submission: ${error instanceof Error ? error.message : String(error)}` },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,GAAG;QAElB,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,GAAG,SAAS,EAAE,OAAO;QAE3D,iBAAiB;QACjB,IAAI,OAAO,UAAU,YAAY,QAAQ,KAAK,QAAQ,KAAK;YACzD,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,OAAO;YAC7C,OAAO,iKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2C,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,QAAQ,GAAG,CAAC;QACZ,MAAM,IAAA,sJAAiB;QAEvB,8BAA8B;QAC9B,MAAM,UAAU,sJAAiB,CAAC,GAAG,CAAC;QACtC,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,UAAU,QAAQ,MAAM;QAC9D,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,sJAAiB,CAAC,IAAI,EAAE;QAC3D,QAAQ,GAAG,CAAC,CAAC,0BAA0B,CAAC,EAAE,MAAM,IAAI,CAAC,sJAAiB,CAAC,IAAI;QAE3E,IAAI,CAAC,SAAS;YACZ,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,GAAG,UAAU,CAAC;YAChD,OAAO,iKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,CAAC,WAAW,EAAE,GAAG,UAAU,CAAC;YAAC,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,WAAW,QAAQ,KAAK;QAC9B,QAAQ,KAAK,GAAG;QAChB,QAAQ,SAAS,GAAG,IAAI,OAAO,WAAW;QAC1C,QAAQ,SAAS,GAAG;QACpB,sJAAiB,CAAC,GAAG,CAAC,IAAI;QAE1B,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,SAAS,aAAa,EAAE,OAAO;QAEnF,eAAe;QACf,QAAQ,GAAG,CAAC;QACZ,MAAM,IAAA,iJAAY;QAElB,QAAQ,GAAG,CAAC;QACZ,OAAO,iKAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,iKAAY,CAAC,IAAI,CACtB;YAAE,OAAO,CAAC,4BAA4B,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO,QAAQ;QAAC,GACjG;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}