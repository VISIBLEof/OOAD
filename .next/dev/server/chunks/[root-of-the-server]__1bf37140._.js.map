{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/auth.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'your-secret-key-change-in-production');\n\nexport async function createToken(userId: string, email: string, role: string) {\n  const token = await new SignJWT({ userId, email, role })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(JWT_SECRET);\n  \n  return token;\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const verified = await jwtVerify(token, JWT_SECRET);\n    return verified.payload as { userId: string; email: string; role: string };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set('auth-token', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 7 * 24 * 60 * 60,\n  });\n}\n\nexport async function getAuthToken() {\n  const cookieStore = await cookies();\n  return cookieStore.get('auth-token')?.value;\n}\n\nexport async function getCurrentUser() {\n  const token = await getAuthToken();\n  if (!token) return null;\n  return verifyToken(token);\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete('auth-token');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE/D,eAAe,YAAY,MAAc,EAAE,KAAa,EAAE,IAAY;IAC3E,MAAM,QAAQ,MAAM,IAAI,mLAAO,CAAC;QAAE;QAAQ;QAAO;IAAK,GACnD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,OAAO;AACT;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,uLAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;IACxB;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,OAAO,YAAY,GAAG,CAAC,eAAe;AACxC;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,YAAY;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/storage.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_DIR = path.join(process.cwd(), '.data');\r\nconst COURSES_FILE = path.join(DATA_DIR, 'courses.json');\r\nconst QUIZZES_FILE = path.join(DATA_DIR, 'quizzes.json');\r\nconst ASSIGNMENTS_FILE = path.join(DATA_DIR, 'assignments.json');\r\nconst ATTEMPTS_FILE = path.join(DATA_DIR, 'attempts.json');\r\n\r\n// Ensure data directory exists\r\nfunction ensureDataDir() {\r\n  if (!fs.existsSync(DATA_DIR)) {\r\n    fs.mkdirSync(DATA_DIR, { recursive: true });\r\n  }\r\n}\r\n\r\n// Load data from file or return empty array\r\nfunction loadFromFile(filePath: string): any[] {\r\n  try {\r\n    ensureDataDir();\r\n    if (fs.existsSync(filePath)) {\r\n      const data = fs.readFileSync(filePath, 'utf-8');\r\n      return JSON.parse(data);\r\n    }\r\n  } catch (error) {\r\n    console.error(`Error loading ${filePath}:`, error);\r\n  }\r\n  return [];\r\n}\r\n\r\n// Save data to file\r\nfunction saveToFile(filePath: string, data: any) {\r\n  try {\r\n    ensureDataDir();\r\n    fs.writeFileSync(filePath, JSON.stringify(data, null, 2), 'utf-8');\r\n  } catch (error) {\r\n    console.error(`Error saving to ${filePath}:`, error);\r\n  }\r\n}\r\n\r\n// Courses\r\nexport const coursesStore: Map<string, any> = new Map();\r\nfunction loadCourses() {\r\n  const data = loadFromFile(COURSES_FILE);\r\n  data.forEach((course: any) => coursesStore.set(course.id, course));\r\n}\r\nexport function saveCourses() {\r\n  const data = Array.from(coursesStore.values());\r\n  saveToFile(COURSES_FILE, data);\r\n}\r\n\r\n// Quizzes\r\nexport const quizzesStore: Map<string, any> = new Map();\r\nfunction loadQuizzes() {\r\n  const data = loadFromFile(QUIZZES_FILE);\r\n  data.forEach((quiz: any) => quizzesStore.set(quiz.id, quiz));\r\n}\r\nexport function saveQuizzes() {\r\n  const data = Array.from(quizzesStore.values());\r\n  saveToFile(QUIZZES_FILE, data);\r\n}\r\n\r\n// Assignments\r\nexport const assignmentsStore: Map<string, any> = new Map();\r\nfunction loadAssignments() {\r\n  const data = loadFromFile(ASSIGNMENTS_FILE);\r\n  data.forEach((assignment: any) => assignmentsStore.set(assignment.id, assignment));\r\n}\r\nexport function saveAssignments() {\r\n  const data = Array.from(assignmentsStore.values());\r\n  saveToFile(ASSIGNMENTS_FILE, data);\r\n}\r\n\r\n// Quiz Attempts\r\nexport const quizAttemptsStore: Map<string, any> = new Map();\r\nfunction loadAttempts() {\r\n  const data = loadFromFile(ATTEMPTS_FILE);\r\n  data.forEach((attempt: any) => quizAttemptsStore.set(attempt.id, attempt));\r\n}\r\nexport function saveAttempts() {\r\n  const data = Array.from(quizAttemptsStore.values());\r\n  saveToFile(ATTEMPTS_FILE, data);\r\n}\r\n\r\n// ID counters\r\nexport let courseIdCounter = 1;\r\nexport let quizIdCounter = 1;\r\nexport let assignmentIdCounter = 1;\r\nexport let quizAttemptIdCounter = 1;\r\n\r\n// Track if storage has been initialized\r\nlet isInitialized = false;\r\n\r\n// Initialize all data on startup\r\nexport function initializeStorage() {\r\n  if (isInitialized) return; // Skip if already initialized\r\n  isInitialized = true;\r\n  \r\n  loadCourses();\r\n  loadQuizzes();\r\n  loadAssignments();\r\n  loadAttempts();\r\n  \r\n  // Set counters based on existing data\r\n  if (coursesStore.size > 0) {\r\n    courseIdCounter = Math.max(...Array.from(coursesStore.values()).map((c: any) => {\r\n      const match = c.id.match(/course_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizzesStore.size > 0) {\r\n    quizIdCounter = Math.max(...Array.from(quizzesStore.values()).map((q: any) => {\r\n      const match = q.id.match(/quiz_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (assignmentsStore.size > 0) {\r\n    assignmentIdCounter = Math.max(...Array.from(assignmentsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/assignment_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizAttemptsStore.size > 0) {\r\n    quizAttemptIdCounter = Math.max(...Array.from(quizAttemptsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/attempt_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  console.log('Storage initialized');\r\n}\r\n\r\nexport function incrementCourseId() {\r\n  const id = courseIdCounter++;\r\n  saveCourses();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizId() {\r\n  const id = quizIdCounter++;\r\n  saveQuizzes();\r\n  return id;\r\n}\r\n\r\nexport function incrementAssignmentId() {\r\n  const id = assignmentIdCounter++;\r\n  saveAssignments();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizAttemptId() {\r\n  const id = quizAttemptIdCounter++;\r\n  saveAttempts();\r\n  return id;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/app/api/quizzes/%5Bid%5D/submit/route.ts"],"sourcesContent":["import { getCurrentUser } from '@/lib/auth';\nimport { sql } from '@vercel/postgres';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { quizzesStore, quizAttemptsStore, initializeStorage } from '@/lib/storage';\n\ninitializeStorage();\n\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const user = await getCurrentUser();\n\n    if (!user) {\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { id } = await params;\n    const { attemptId, answers } = await request.json();\n\n    // Get quiz from memory or database\n    let quiz = quizzesStore.get(id);\n\n    if (!quiz) {\n      try {\n        const quizResult = await sql`\n          SELECT id FROM quizzes WHERE id = ${id}\n        `;\n        if (quizResult.rows.length === 0) {\n          return NextResponse.json({ success: false, error: 'Quiz not found' }, { status: 404 });\n        }\n      } catch {\n        return NextResponse.json({ success: false, error: 'Quiz not found' }, { status: 404 });\n      }\n    }\n\n    // Update quiz attempt in memory\n    const attempt = quizAttemptsStore.get(attemptId);\n    if (!attempt) {\n      return NextResponse.json({ success: false, error: 'Attempt not found' }, { status: 404 });\n    }\n\n    const updatedAttempt = {\n      ...attempt,\n      answers,\n      score: null,\n      finished_at: new Date().toISOString(),\n      student_email: user.email,\n    };\n\n    quizAttemptsStore.set(attemptId, updatedAttempt);\n\n    // Try to save to database, but don't fail if it doesn't work\n    try {\n      await sql`\n        UPDATE quiz_attempts \n        SET answers = ${JSON.stringify(answers)}, score = NULL, finished_at = NOW()\n        WHERE id = ${attemptId} AND student_id = ${user.userId}\n      `;\n    } catch {\n      // Database not available, but we saved to memory\n      console.log('Database unavailable, saved submission to memory');\n    }\n\n    return NextResponse.json({ success: true, data: { attemptId, finished_at: updatedAttempt.finished_at } }, { status: 201 });\n  } catch (error: any) {\n    console.error('Quiz submit error:', error);\n    return NextResponse.json({ success: false, error: 'Failed to submit quiz' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEA,IAAA,sJAAiB;AAEV,eAAe,KAAK,OAAoB,EAAE,EAAE,MAAM,EAAuC;IAC9F,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,gJAAc;QAEjC,IAAI,CAAC,MAAM;YACT,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjD,mCAAmC;QACnC,IAAI,OAAO,iJAAY,CAAC,GAAG,CAAC;QAE5B,IAAI,CAAC,MAAM;YACT,IAAI;gBACF,MAAM,aAAa,MAAM,2MAAG,CAAC;4CACO,EAAE,GAAG;QACzC,CAAC;gBACD,IAAI,WAAW,IAAI,CAAC,MAAM,KAAK,GAAG;oBAChC,OAAO,iKAAY,CAAC,IAAI,CAAC;wBAAE,SAAS;wBAAO,OAAO;oBAAiB,GAAG;wBAAE,QAAQ;oBAAI;gBACtF;YACF,EAAE,OAAM;gBACN,OAAO,iKAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAO,OAAO;gBAAiB,GAAG;oBAAE,QAAQ;gBAAI;YACtF;QACF;QAEA,gCAAgC;QAChC,MAAM,UAAU,sJAAiB,CAAC,GAAG,CAAC;QACtC,IAAI,CAAC,SAAS;YACZ,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,MAAM,iBAAiB;YACrB,GAAG,OAAO;YACV;YACA,OAAO;YACP,aAAa,IAAI,OAAO,WAAW;YACnC,eAAe,KAAK,KAAK;QAC3B;QAEA,sJAAiB,CAAC,GAAG,CAAC,WAAW;QAEjC,6DAA6D;QAC7D,IAAI;YACF,MAAM,2MAAG,CAAC;;sBAEM,EAAE,KAAK,SAAS,CAAC,SAAS;mBAC7B,EAAE,UAAU,kBAAkB,EAAE,KAAK,MAAM,CAAC;MACzD,CAAC;QACH,EAAE,OAAM;YACN,iDAAiD;YACjD,QAAQ,GAAG,CAAC;QACd;QAEA,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;gBAAE;gBAAW,aAAa,eAAe,WAAW;YAAC;QAAE,GAAG;YAAE,QAAQ;QAAI;IAC1H,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF"}}]
}