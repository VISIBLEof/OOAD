{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/auth.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'your-secret-key-change-in-production');\n\nexport async function createToken(userId: string, email: string, role: string) {\n  const token = await new SignJWT({ userId, email, role })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(JWT_SECRET);\n  \n  return token;\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const verified = await jwtVerify(token, JWT_SECRET);\n    return verified.payload as { userId: string; email: string; role: string };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set('auth-token', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 7 * 24 * 60 * 60,\n  });\n}\n\nexport async function getAuthToken() {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('auth-token')?.value;\n    console.log('getAuthToken - found token:', token ? 'yes' : 'no');\n    return token;\n  } catch (err) {\n    console.log('getAuthToken - cookies() error:', err);\n    return null;\n  }\n}\n\nexport async function getCurrentUser() {\n  try {\n    const token = await getAuthToken();\n    console.log('getCurrentUser - token from cookie:', token ? 'yes' : 'no');\n    if (!token) return null;\n    const verified = await verifyToken(token);\n    console.log('getCurrentUser - verified:', verified ? 'yes' : 'no');\n    return verified;\n  } catch (err) {\n    console.log('getCurrentUser - error:', err);\n    return null;\n  }\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete('auth-token');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE/D,eAAe,YAAY,MAAc,EAAE,KAAa,EAAE,IAAY;IAC3E,MAAM,QAAQ,MAAM,IAAI,mLAAO,CAAC;QAAE;QAAQ;QAAO;IAAK,GACnD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,OAAO;AACT;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,uLAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;IACxB;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,6JAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;QAC7C,QAAQ,GAAG,CAAC,+BAA+B,QAAQ,QAAQ;QAC3D,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,GAAG,CAAC,mCAAmC;QAC/C,OAAO;IACT;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM;QACpB,QAAQ,GAAG,CAAC,uCAAuC,QAAQ,QAAQ;QACnE,IAAI,CAAC,OAAO,OAAO;QACnB,MAAM,WAAW,MAAM,YAAY;QACnC,QAAQ,GAAG,CAAC,8BAA8B,WAAW,QAAQ;QAC7D,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,GAAG,CAAC,2BAA2B;QACvC,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/app/api/assignments/%5Bid%5D/submissions/route.ts"],"sourcesContent":["import { getCurrentUser } from '@/lib/auth';\nimport { sql } from '@vercel/postgres';\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const user = await getCurrentUser();\n\n    if (!user || user.role !== 'teacher') {\n      return NextResponse.json({ success: false, error: 'Only teachers can view submissions' }, { status: 403 });\n    }\n\n    const { id } = await params;\n\n    const result = await sql`\n      SELECT s.id, s.assignment_id, s.student_id, s.content, s.grade, s.feedback, s.submitted_at,\n             u.name as student_name, u.email as student_email\n      FROM submissions s\n      JOIN users u ON s.student_id = u.id\n      WHERE s.assignment_id = ${id}\n      ORDER BY s.submitted_at DESC\n    `;\n\n    return NextResponse.json({ success: true, data: result.rows });\n  } catch (error) {\n    return NextResponse.json({ success: false, error: 'Failed to fetch submissions' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;;;;AAEO,eAAe,IAAI,OAAoB,EAAE,EAAE,MAAM,EAAuC;IAC7F,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,gJAAc;QAEjC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;YACpC,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAqC,GAAG;gBAAE,QAAQ;YAAI;QAC1G;QAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,MAAM,SAAS,MAAM,2MAAG,CAAC;;;;;8BAKC,EAAE,GAAG;;IAE/B,CAAC;QAED,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM,OAAO,IAAI;QAAC;IAC9D,EAAE,OAAO,OAAO;QACd,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnG;AACF"}}]
}