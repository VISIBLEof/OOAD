{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/auth.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'your-secret-key-change-in-production');\n\nexport async function createToken(userId: string, email: string, role: string) {\n  const token = await new SignJWT({ userId, email, role })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(JWT_SECRET);\n  \n  return token;\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const verified = await jwtVerify(token, JWT_SECRET);\n    return verified.payload as { userId: string; email: string; role: string };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set('auth-token', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 7 * 24 * 60 * 60,\n  });\n}\n\nexport async function getAuthToken() {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('auth-token')?.value;\n    console.log('getAuthToken - found token:', token ? 'yes' : 'no');\n    return token;\n  } catch (err) {\n    console.log('getAuthToken - cookies() error:', err);\n    return null;\n  }\n}\n\nexport async function getCurrentUser() {\n  try {\n    const token = await getAuthToken();\n    console.log('getCurrentUser - token from cookie:', token ? 'yes' : 'no');\n    if (!token) return null;\n    const verified = await verifyToken(token);\n    console.log('getCurrentUser - verified:', verified ? 'yes' : 'no');\n    return verified;\n  } catch (err) {\n    console.log('getCurrentUser - error:', err);\n    return null;\n  }\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete('auth-token');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE/D,eAAe,YAAY,MAAc,EAAE,KAAa,EAAE,IAAY;IAC3E,MAAM,QAAQ,MAAM,IAAI,mLAAO,CAAC;QAAE;QAAQ;QAAO;IAAK,GACnD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,OAAO;AACT;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,uLAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;IACxB;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,6JAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;QAC7C,QAAQ,GAAG,CAAC,+BAA+B,QAAQ,QAAQ;QAC3D,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,GAAG,CAAC,mCAAmC;QAC/C,OAAO;IACT;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM;QACpB,QAAQ,GAAG,CAAC,uCAAuC,QAAQ,QAAQ;QACnE,IAAI,CAAC,OAAO,OAAO;QACnB,MAAM,WAAW,MAAM,YAAY;QACnC,QAAQ,GAAG,CAAC,8BAA8B,WAAW,QAAQ;QAC7D,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,GAAG,CAAC,2BAA2B;QACvC,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/storage.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_DIR = path.join(process.cwd(), '.data');\r\nconst COURSES_FILE = path.join(DATA_DIR, 'courses.json');\r\nconst QUIZZES_FILE = path.join(DATA_DIR, 'quizzes.json');\r\nconst ASSIGNMENTS_FILE = path.join(DATA_DIR, 'assignments.json');\r\nconst ATTEMPTS_FILE = path.join(DATA_DIR, 'attempts.json');\r\nconst SUBMISSIONS_FILE = path.join(DATA_DIR, 'submissions.json');\r\n\r\n// Ensure data directory exists\r\nfunction ensureDataDir() {\r\n  if (!fs.existsSync(DATA_DIR)) {\r\n    fs.mkdirSync(DATA_DIR, { recursive: true });\r\n  }\r\n}\r\n\r\n// Load data from file or return empty array\r\nfunction loadFromFile(filePath: string): any[] {\r\n  try {\r\n    ensureDataDir();\r\n    if (fs.existsSync(filePath)) {\r\n      const data = fs.readFileSync(filePath, 'utf-8');\r\n      return JSON.parse(data);\r\n    }\r\n  } catch (error) {\r\n    console.error(`Error loading ${filePath}:`, error);\r\n  }\r\n  return [];\r\n}\r\n\r\n// Save data to file\r\nfunction saveToFile(filePath: string, data: any) {\r\n  try {\r\n    ensureDataDir();\r\n    fs.writeFileSync(filePath, JSON.stringify(data, null, 2), 'utf-8');\r\n  } catch (error) {\r\n    console.error(`Error saving to ${filePath}:`, error);\r\n  }\r\n}\r\n\r\n// Courses\r\nexport const coursesStore: Map<string, any> = new Map();\r\nfunction loadCourses() {\r\n  const data = loadFromFile(COURSES_FILE);\r\n  data.forEach((course: any) => coursesStore.set(course.id, course));\r\n}\r\nexport function saveCourses() {\r\n  const data = Array.from(coursesStore.values());\r\n  saveToFile(COURSES_FILE, data);\r\n}\r\n\r\n// Quizzes\r\nexport const quizzesStore: Map<string, any> = new Map();\r\nfunction loadQuizzes() {\r\n  const data = loadFromFile(QUIZZES_FILE);\r\n  data.forEach((quiz: any) => quizzesStore.set(quiz.id, quiz));\r\n}\r\nexport function saveQuizzes() {\r\n  const data = Array.from(quizzesStore.values());\r\n  saveToFile(QUIZZES_FILE, data);\r\n}\r\n\r\n// Assignments\r\nexport const assignmentsStore: Map<string, any> = new Map();\r\nfunction loadAssignments() {\r\n  const data = loadFromFile(ASSIGNMENTS_FILE);\r\n  data.forEach((assignment: any) => assignmentsStore.set(assignment.id, assignment));\r\n}\r\nexport function saveAssignments() {\r\n  const data = Array.from(assignmentsStore.values());\r\n  saveToFile(ASSIGNMENTS_FILE, data);\r\n}\r\n\r\n// Quiz Attempts\r\nexport const quizAttemptsStore: Map<string, any> = new Map();\r\nfunction loadAttempts() {\r\n  const data = loadFromFile(ATTEMPTS_FILE);\r\n  data.forEach((attempt: any) => quizAttemptsStore.set(attempt.id, attempt));\r\n}\r\nexport function saveAttempts() {\r\n  const data = Array.from(quizAttemptsStore.values());\r\n  saveToFile(ATTEMPTS_FILE, data);\r\n}\r\n\r\n// Assignment Submissions\r\nexport const submissionsStore: Map<string, any> = new Map();\r\nfunction loadSubmissions() {\r\n  const data = loadFromFile(SUBMISSIONS_FILE);\r\n  data.forEach((submission: any) => submissionsStore.set(submission.id, submission));\r\n}\r\nexport function saveSubmissions() {\r\n  const data = Array.from(submissionsStore.values());\r\n  saveToFile(SUBMISSIONS_FILE, data);\r\n}\r\n\r\n// ID counters\r\nexport let courseIdCounter = 1;\r\nexport let quizIdCounter = 1;\r\nexport let assignmentIdCounter = 1;\r\nexport let quizAttemptIdCounter = 1;\r\nexport let submissionIdCounter = 1;\r\n\r\n// Track if storage has been initialized\r\nlet isInitialized = false;\r\n\r\n// Initialize all data on startup\r\nexport function initializeStorage() {\r\n  if (isInitialized) return; // Skip if already initialized\r\n  isInitialized = true;\r\n  \r\n  loadCourses();\r\n  loadQuizzes();\r\n  loadAssignments();\r\n  loadAttempts();\r\n  loadSubmissions();\r\n  \r\n  // Set counters based on existing data\r\n  if (coursesStore.size > 0) {\r\n    courseIdCounter = Math.max(...Array.from(coursesStore.values()).map((c: any) => {\r\n      const match = c.id.match(/course_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizzesStore.size > 0) {\r\n    quizIdCounter = Math.max(...Array.from(quizzesStore.values()).map((q: any) => {\r\n      const match = q.id.match(/quiz_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (assignmentsStore.size > 0) {\r\n    assignmentIdCounter = Math.max(...Array.from(assignmentsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/assignment_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  if (quizAttemptsStore.size > 0) {\r\n    quizAttemptIdCounter = Math.max(...Array.from(quizAttemptsStore.values()).map((a: any) => {\r\n      const match = a.id.match(/attempt_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n\r\n  if (submissionsStore.size > 0) {\r\n    submissionIdCounter = Math.max(...Array.from(submissionsStore.values()).map((s: any) => {\r\n      const match = s.id.match(/submission_(\\d+)/);\r\n      return match ? parseInt(match[1]) : 0;\r\n    })) + 1;\r\n  }\r\n  \r\n  console.log('Storage initialized');\r\n}\r\n\r\nexport function incrementCourseId() {\r\n  const id = courseIdCounter++;\r\n  saveCourses();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizId() {\r\n  const id = quizIdCounter++;\r\n  saveQuizzes();\r\n  return id;\r\n}\r\n\r\nexport function incrementAssignmentId() {\r\n  const id = assignmentIdCounter++;\r\n  saveAssignments();\r\n  return id;\r\n}\r\n\r\nexport function incrementQuizAttemptId() {\r\n  const id = quizAttemptIdCounter++;\r\n  saveAttempts();\r\n  return id;\r\n}\r\n\r\nexport function incrementSubmissionId() {\r\n  const id = submissionIdCounter++;\r\n  saveSubmissions();\r\n  return id;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 343, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/app/api/assignments/%5Bid%5D/submit/route.ts"],"sourcesContent":["import { getCurrentUser } from '@/lib/auth';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { initializeStorage, submissionsStore, saveSubmissions, incrementSubmissionId } from '@/lib/storage';\n\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const user = await getCurrentUser();\n\n    if (!user || user.role !== 'student') {\n      return NextResponse.json({ success: false, error: 'Only students can submit assignments' }, { status: 403 });\n    }\n\n    const { id } = await params;\n    const { content } = await request.json();\n\n    if (!content || content.trim() === '') {\n      return NextResponse.json({ success: false, error: 'Submission content cannot be empty' }, { status: 400 });\n    }\n\n    // Initialize storage\n    await initializeStorage();\n\n    // Create submission\n    const submissionId = `submission_${incrementSubmissionId()}`;\n    const submission = {\n      id: submissionId,\n      assignment_id: id,\n      student_id: user.userId,\n      student_email: user.email,\n      content,\n      grade: null,\n      feedback: null,\n      submitted_at: new Date().toISOString(),\n    };\n\n    submissionsStore.set(submissionId, submission);\n    await saveSubmissions();\n\n    return NextResponse.json({ success: true, data: submission }, { status: 201 });\n  } catch (error) {\n    console.error('Assignment submit error:', error);\n    return NextResponse.json({ success: false, error: 'Failed to submit assignment' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB,EAAE,EAAE,MAAM,EAAuC;IAC9F,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,gJAAc;QAEjC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;YACpC,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC5G;QAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEtC,IAAI,CAAC,WAAW,QAAQ,IAAI,OAAO,IAAI;YACrC,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAqC,GAAG;gBAAE,QAAQ;YAAI;QAC1G;QAEA,qBAAqB;QACrB,MAAM,IAAA,sJAAiB;QAEvB,oBAAoB;QACpB,MAAM,eAAe,CAAC,WAAW,EAAE,IAAA,0JAAqB,KAAI;QAC5D,MAAM,aAAa;YACjB,IAAI;YACJ,eAAe;YACf,YAAY,KAAK,MAAM;YACvB,eAAe,KAAK,KAAK;YACzB;YACA,OAAO;YACP,UAAU;YACV,cAAc,IAAI,OAAO,WAAW;QACtC;QAEA,qJAAgB,CAAC,GAAG,CAAC,cAAc;QACnC,MAAM,IAAA,oJAAe;QAErB,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAW,GAAG;YAAE,QAAQ;QAAI;IAC9E,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnG;AACF"}}]
}