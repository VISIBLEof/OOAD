{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/auth.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'your-secret-key-change-in-production');\n\nexport async function createToken(userId: string, email: string, role: string) {\n  const token = await new SignJWT({ userId, email, role })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(JWT_SECRET);\n  \n  return token;\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const verified = await jwtVerify(token, JWT_SECRET);\n    return verified.payload as { userId: string; email: string; role: string };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set('auth-token', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 7 * 24 * 60 * 60,\n  });\n}\n\nexport async function getAuthToken() {\n  const cookieStore = await cookies();\n  return cookieStore.get('auth-token')?.value;\n}\n\nexport async function getCurrentUser() {\n  const token = await getAuthToken();\n  if (!token) return null;\n  return verifyToken(token);\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete('auth-token');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE/D,eAAe,YAAY,MAAc,EAAE,KAAa,EAAE,IAAY;IAC3E,MAAM,QAAQ,MAAM,IAAI,mLAAO,CAAC;QAAE;QAAQ;QAAO;IAAK,GACnD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,OAAO;AACT;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,uLAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;IACxB;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,OAAO,YAAY,GAAG,CAAC,eAAe;AACxC;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,YAAY;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/app/api/courses/route.ts"],"sourcesContent":["import { getCurrentUser } from '@/lib/auth';\nimport { sql } from '@vercel/postgres';\nimport { NextRequest, NextResponse } from 'next/server';\n\n// In-memory storage for courses (development only)\nconst coursesStore: Map<string, any> = new Map();\nlet courseIdCounter = 1;\n\nexport async function GET(request: NextRequest) {\n  try {\n    const user = await getCurrentUser();\n\n    if (!user) {\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Try to get from database first, fall back to in-memory\n    try {\n      if (user.role === 'teacher') {\n        const result = await sql`\n          SELECT id, code, title, description, teacher_id, created_at \n          FROM courses \n          WHERE teacher_id = ${user.userId}\n          ORDER BY created_at DESC\n        `;\n        return NextResponse.json({ success: true, data: result.rows });\n      }\n\n      const result = await sql`\n        SELECT id, code, title, description, teacher_id, created_at \n        FROM courses \n        ORDER BY created_at DESC\n      `;\n      return NextResponse.json({ success: true, data: result.rows });\n    } catch (dbError) {\n      // Database not available, return in-memory courses\n      const courses = Array.from(coursesStore.values());\n      if (user.role === 'teacher') {\n        return NextResponse.json({ success: true, data: courses.filter(c => c.teacher_id === user.userId) });\n      }\n      return NextResponse.json({ success: true, data: courses });\n    }\n  } catch (error) {\n    return NextResponse.json({ success: false, error: 'Failed to fetch courses' }, { status: 500 });\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const user = await getCurrentUser();\n\n    console.log('Course POST - User:', user);\n\n    if (!user) {\n      console.log('Course POST - No user');\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\n    }\n\n    // Allow both teacher and admin to create courses (also allow student during development)\n    console.log('Course POST - User role:', user.role);\n\n    const { code, title, description } = await request.json();\n\n    // Try database first, fall back to in-memory storage\n    try {\n      const result = await sql`\n        INSERT INTO courses (code, title, description, teacher_id)\n        VALUES (${code}, ${title}, ${description || null}, ${user.userId})\n        RETURNING id, code, title, description, teacher_id, created_at\n      `;\n      return NextResponse.json({ success: true, data: result.rows[0] }, { status: 201 });\n    } catch (dbError: any) {\n      console.log('Database error, using in-memory storage:', dbError.message);\n      \n      // Use in-memory storage instead\n      const courseId = `course_${courseIdCounter++}`;\n      const course = {\n        id: courseId,\n        code,\n        title,\n        description: description || null,\n        teacher_id: user.userId,\n        created_at: new Date().toISOString(),\n      };\n      coursesStore.set(courseId, course);\n      console.log('Course created in memory:', courseId);\n      \n      return NextResponse.json({ success: true, data: course }, { status: 201 });\n    }\n  } catch (error: any) {\n    console.error('Course POST error:', error);\n    return NextResponse.json({ success: false, error: 'Failed to create course' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}