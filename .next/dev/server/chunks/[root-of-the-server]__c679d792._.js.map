{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/auth.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'your-secret-key-change-in-production');\n\nexport async function createToken(userId: string, email: string, role: string) {\n  const token = await new SignJWT({ userId, email, role })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('7d')\n    .sign(JWT_SECRET);\n  \n  return token;\n}\n\nexport async function verifyToken(token: string) {\n  try {\n    const verified = await jwtVerify(token, JWT_SECRET);\n    return verified.payload as { userId: string; email: string; role: string };\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function setAuthCookie(token: string) {\n  const cookieStore = await cookies();\n  cookieStore.set('auth-token', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 7 * 24 * 60 * 60,\n  });\n}\n\nexport async function getAuthToken() {\n  const cookieStore = await cookies();\n  return cookieStore.get('auth-token')?.value;\n}\n\nexport async function getCurrentUser() {\n  const token = await getAuthToken();\n  if (!token) return null;\n  return verifyToken(token);\n}\n\nexport async function clearAuthCookie() {\n  const cookieStore = await cookies();\n  cookieStore.delete('auth-token');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE/D,eAAe,YAAY,MAAc,EAAE,KAAa,EAAE,IAAY;IAC3E,MAAM,QAAQ,MAAM,IAAI,mLAAO,CAAC;QAAE;QAAQ;QAAO;IAAK,GACnD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,MAClB,IAAI,CAAC;IAER,OAAO;AACT;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,uLAAS,EAAC,OAAO;QACxC,OAAO,SAAS,OAAO;IACzB,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,IAAI,KAAK,KAAK;IACxB;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,OAAO,YAAY,GAAG,CAAC,eAAe;AACxC;AAEO,eAAe;IACpB,MAAM,QAAQ,MAAM;IACpB,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,YAAY;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/db.ts"],"sourcesContent":["import { createClient, SupabaseClient } from '@supabase/supabase-js';\n\nconst SUPABASE_URL = process.env.SUPABASE_URL;\nconst SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_KEY;\n\nif (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE_KEY) {\n  // Do not throw here to allow the app to run in environments where DB isn't configured yet,\n  // but many routes will fail until env is provided.\n  console.warn('SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY is not set. Supabase client will not be initialized.');\n}\n\nexport const supabaseAdmin: SupabaseClient | null =\n  SUPABASE_URL && SUPABASE_SERVICE_ROLE_KEY\n    ? createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, { auth: { persistSession: false } })\n    : null;\n\nexport async function getUserByEmail(email: string) {\n  if (!supabaseAdmin) throw new Error('Supabase client not initialized');\n  const { data, error } = await supabaseAdmin.from('users').select('id, email, password_hash, name, role').eq('email', email).limit(1).maybeSingle();\n  if (error) throw error;\n  return data as any | null;\n}\n\nexport async function createUser({ name, email, passwordHash, role = 'student' }: { name: string; email: string; passwordHash: string; role?: string; }) {\n  if (!supabaseAdmin) throw new Error('Supabase client not initialized');\n  const { data, error } = await supabaseAdmin.from('users').insert({ name, email, password_hash: passwordHash, role }).select('id, email, role').maybeSingle();\n  if (error) throw error;\n  return data;\n}\n\nexport async function getUserById(id: string) {\n  if (!supabaseAdmin) throw new Error('Supabase client not initialized');\n  const { data, error } = await supabaseAdmin.from('users').select('id, name, email, role').eq('id', id).limit(1).maybeSingle();\n  if (error) throw error;\n  return data;\n}\n\n// Optional: small helper to run raw SQL if needed via RPC or other means. For now we rely on standard CRUD methods.\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,YAAY;AAC7C,MAAM,4BAA4B,QAAQ,GAAG,CAAC,yBAAyB,IAAI,QAAQ,GAAG,CAAC,YAAY;AAEnG,IAAI,CAAC,gBAAgB,CAAC,2BAA2B;IAC/C,2FAA2F;IAC3F,mDAAmD;IACnD,QAAQ,IAAI,CAAC;AACf;AAEO,MAAM,gBACX,gBAAgB,4BACZ,IAAA,0NAAY,EAAC,cAAc,2BAA2B;IAAE,MAAM;QAAE,gBAAgB;IAAM;AAAE,KACxF;AAEC,eAAe,eAAe,KAAa;IAChD,IAAI,CAAC,eAAe,MAAM,IAAI,MAAM;IACpC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAAc,IAAI,CAAC,SAAS,MAAM,CAAC,wCAAwC,EAAE,CAAC,SAAS,OAAO,KAAK,CAAC,GAAG,WAAW;IAChJ,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,WAAW,EAAE,IAAI,EAAE,KAAK,EAAE,YAAY,EAAE,OAAO,SAAS,EAAyE;IACrJ,IAAI,CAAC,eAAe,MAAM,IAAI,MAAM;IACpC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAAc,IAAI,CAAC,SAAS,MAAM,CAAC;QAAE;QAAM;QAAO,eAAe;QAAc;IAAK,GAAG,MAAM,CAAC,mBAAmB,WAAW;IAC1J,IAAI,OAAO,MAAM;IACjB,OAAO;AACT;AAEO,eAAe,YAAY,EAAU;IAC1C,IAAI,CAAC,eAAe,MAAM,IAAI,MAAM;IACpC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAAc,IAAI,CAAC,SAAS,MAAM,CAAC,yBAAyB,EAAE,CAAC,MAAM,IAAI,KAAK,CAAC,GAAG,WAAW;IAC3H,IAAI,OAAO,MAAM;IACjB,OAAO;AACT,EAEA,oHAAoH"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/lib/validation.ts"],"sourcesContent":["export function validateEmail(email: string): boolean {\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n}\n\nexport function validatePassword(password: string): boolean {\n  return password.length >= 8;\n}\n\nexport function sanitizeInput(input: string): string {\n  return input.trim().replace(/[<>]/g, '');\n}\n"],"names":[],"mappings":";;;;;;;;AAAO,SAAS,cAAc,KAAa;IACzC,OAAO,6BAA6B,IAAI,CAAC;AAC3C;AAEO,SAAS,iBAAiB,QAAgB;IAC/C,OAAO,SAAS,MAAM,IAAI;AAC5B;AAEO,SAAS,cAAc,KAAa;IACzC,OAAO,MAAM,IAAI,GAAG,OAAO,CAAC,SAAS;AACvC"}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Voltex/Downloads/OOAD%20Project/OOAD%20Project/app/api/auth/register/route.ts"],"sourcesContent":["import { createToken, setAuthCookie } from '@/lib/auth';\nimport { createUser, getUserByEmail } from '@/lib/db';\nimport { validateEmail, validatePassword } from '@/lib/validation';\nimport bcrypt from 'bcryptjs';\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { name, email, password, role = 'student' } = await request.json();\n\n    if (!validateEmail(email)) {\n      return NextResponse.json({ success: false, error: 'Invalid email' }, { status: 400 });\n    }\n\n    if (!validatePassword(password)) {\n      return NextResponse.json({ success: false, error: 'Password must be at least 8 characters' }, { status: 400 });\n    }\n\n    const passwordHash = await bcrypt.hash(password, 10);\n\n    // Prevent duplicate registration\n    const existing = await getUserByEmail(email);\n    if (existing) {\n      return NextResponse.json({ success: false, error: 'Email already exists' }, { status: 400 });\n    }\n\n    let user;\n    try {\n      user = await createUser({ name, email, passwordHash, role });\n    } catch (dbErr: any) {\n      console.error('createUser error:', dbErr);\n      const message = dbErr?.message || dbErr?.toString() || 'Registration failed';\n      if (message.toLowerCase().includes('duplicate') || message.toLowerCase().includes('already exists') || (dbErr?.code && dbErr.code === '23505')) {\n        return NextResponse.json({ success: false, error: 'Email already exists' }, { status: 400 });\n      }\n      return NextResponse.json({ success: false, error: message }, { status: 500 });\n    }\n\n    if (!user) {\n      return NextResponse.json({ success: false, error: 'Registration failed' }, { status: 500 });\n    }\n\n    const token = await createToken(user.id as string, user.email as string, user.role as string);\n    await setAuthCookie(token);\n\n    return NextResponse.json({\n      success: true,\n      data: { userId: user.id, email: user.email, role: user.role, token },\n    });\n  } catch (error: any) {\n    console.error('register route error:', error);\n    const msg = error?.message || 'Registration failed';\n    return NextResponse.json({ success: false, error: msg }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEtE,IAAI,CAAC,IAAA,qJAAa,EAAC,QAAQ;YACzB,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,IAAI,CAAC,IAAA,wJAAgB,EAAC,WAAW;YAC/B,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAyC,GAAG;gBAAE,QAAQ;YAAI;QAC9G;QAEA,MAAM,eAAe,MAAM,+JAAM,CAAC,IAAI,CAAC,UAAU;QAEjD,iCAAiC;QACjC,MAAM,WAAW,MAAM,IAAA,8IAAc,EAAC;QACtC,IAAI,UAAU;YACZ,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,IAAI;QACJ,IAAI;YACF,OAAO,MAAM,IAAA,0IAAU,EAAC;gBAAE;gBAAM;gBAAO;gBAAc;YAAK;QAC5D,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,qBAAqB;YACnC,MAAM,UAAU,OAAO,WAAW,OAAO,cAAc;YACvD,IAAI,QAAQ,WAAW,GAAG,QAAQ,CAAC,gBAAgB,QAAQ,WAAW,GAAG,QAAQ,CAAC,qBAAsB,OAAO,QAAQ,MAAM,IAAI,KAAK,SAAU;gBAC9I,OAAO,iKAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAO,OAAO;gBAAuB,GAAG;oBAAE,QAAQ;gBAAI;YAC5F;YACA,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAQ,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,iKAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3F;QAEA,MAAM,QAAQ,MAAM,IAAA,6IAAW,EAAC,KAAK,EAAE,EAAY,KAAK,KAAK,EAAY,KAAK,IAAI;QAClF,MAAM,IAAA,+IAAa,EAAC;QAEpB,OAAO,iKAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBAAE,QAAQ,KAAK,EAAE;gBAAE,OAAO,KAAK,KAAK;gBAAE,MAAM,KAAK,IAAI;gBAAE;YAAM;QACrE;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,MAAM,OAAO,WAAW;QAC9B,OAAO,iKAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAI,GAAG;YAAE,QAAQ;QAAI;IACzE;AACF"}}]
}